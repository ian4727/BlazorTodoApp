@page "/"
@using blazortodoapp.Models;
@using blazortodoapp.Services;
@using System.Text.Json;
@using BlazorTodoApp.Components.Controls;

@rendermode InteractiveServer

<PageTitle>To-do List App</PageTitle>

<TodoList Items="TodoItems" OnChanged="OnTodoListChanged"/>


@code {
    [Inject]
    public TodoStorageService TodoStorageService { get; set; } = default;

    protected Dictionary<int, TodoItem> TodoItems { get; set; } = [];
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            TodoItems = await TodoStorageService.GetTodoAsync();
            await InvokeAsync(StateHasChanged);
        }
    }

    protected async void OnTodoListChanged(TodoItemChangedEventArgs e)
    {
        await TodoStorageService.SaveTodosAsync(TodoItems);
        await InvokeAsync(StateHasChanged);
    }
    
}